---
import { type CollectionEntry, getCollection } from "astro:content";
import PostPreview from "@/components/blog/PostPreview.astro";
import Note from "@/components/note/Note.astro";
import { getAllPosts } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";

// Posts
const MAX_POSTS = 10;
const allPosts = await getAllPosts();
const allPostsByDate = allPosts.sort(collectionDateSort) as CollectionEntry<"post">[];
const latestPosts = allPostsByDate.slice(0, MAX_POSTS);

// Pinned Posts, set to a max of 3;
const MAX_PINNED_POSTS = 3;
const pinnedPosts = allPostsByDate.filter((p) => p.data.pinned).slice(0, MAX_PINNED_POSTS);

// Notes
const MAX_NOTES = 5;
const allNotes = await getCollection("note");
const latestNotes = allNotes
	.sort(collectionDateSort)
	.slice(0, MAX_NOTES) as CollectionEntry<"note">[];
---

<PageLayout meta={{ title: "Home" }}>
	<section>
		<h1 class="title mb-12">Hello world! Microsoft enthusiast</h1>
		<p class="mb-4">
			If you are here, you probably know me or found my site through somewhere else. Welcome to my
			personal corner of the internet where I share my thoughts, projects, and experiences related
			to Microsoft technologies. Feel free to explore my blog posts and notes, and don't hesitate to
			reach out if you have any questions or just want to say hi! If you find some incorrect
			information or broken links, please let me know by <a
				href="mailto:federico@federico.dev"
				target="_blank">federico@federico.dev</a
			>. Enjoy your stay!
		</p>
		{
			pinnedPosts.length > 0 && (
				<section class="mt-16">
					<h2 class="title mb-6 text-xl">Pinned Posts</h2>
					<ul class="space-y-4" role="list">
						{pinnedPosts.map((p) => (
							<li class="grid gap-1 sm:grid-cols-[auto_1fr]">
								<PostPreview post={p} />
							</li>
						))}
					</ul>
				</section>
			)
		}
		<section class="mt-16">
			<h2 class="title text-accent mb-6 text-xl"><a href="/posts/">Posts</a></h2>
			<ul class="space-y-4" role="list">
				{
					latestPosts.map((p) => (
						<li class="grid gap-1 sm:grid-cols-[auto_1fr]">
							<PostPreview post={p} />
						</li>
					))
				}
			</ul>
		</section>
		{
			latestNotes.length > 0 && (
				<section class="mt-16">
					<h2 class="title text-accent mb-6 text-xl">
						<a href="/notes/">Notes</a>
					</h2>
					<ul class="space-y-6" role="list">
						{latestNotes.map((note) => (
							<li>
								<Note note={note} as="h3" isPreview />
							</li>
						))}
					</ul>
				</section>
			)
		}
	</section>
</PageLayout>
